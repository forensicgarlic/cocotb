
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Test Bench Tools &#8212; cocotb 1.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Library Reference" href="library_reference.html" />
    <link rel="prev" title="Triggers" href="triggers.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="library_reference.html" title="Library Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="triggers.html" title="Triggers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">cocotb 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="test-bench-tools">
<h1>Test Bench Tools<a class="headerlink" href="#test-bench-tools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>Cocotb extends the python logging library. Each dut, monitor, driver, and scoreboard (as well as any other function using the <strong>coroutine</strong> decorator) implements it’s own <code class="xref py py-class docutils literal notranslate"><span class="pre">logging</span></code> object, and each can be set to it’s own logging level. Within a dut, each heirarchical object can also have individual logging levels set.</p>
<p>When logging hdl objects, beware that <strong>_log</strong> is the preferred way to use logging. This helps minimize the change of name collisions with an hdl log component with the python logging functionality.</p>
<p>Log printing levels can also be set on a per object basis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EndianSwapperTB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dut</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dut</span> <span class="o">=</span> <span class="n">dut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_in</span> <span class="o">=</span> <span class="n">AvalonSTDriver</span><span class="p">(</span><span class="n">dut</span><span class="p">,</span> <span class="s2">&quot;stream_in&quot;</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">clk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_in_recovered</span> <span class="o">=</span> <span class="n">AvalonSTMonitor</span><span class="p">(</span><span class="n">dut</span><span class="p">,</span> <span class="s2">&quot;stream_in&quot;</span><span class="p">,</span> <span class="n">dut</span><span class="o">.</span><span class="n">clk</span><span class="p">,</span>
                                                   <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># Set verbosity on our various interfaces</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_in</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_in_recovered</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dut</span><span class="o">.</span><span class="n">reset_n</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>And when the logging is actually called</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AvalonSTPkts</span><span class="p">(</span><span class="n">BusMonitor</span><span class="p">):</span>
<span class="o">...</span>
    <span class="nd">@coroutine</span>
    <span class="k">def</span> <span class="nf">_monitor_recv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received a packet of </span><span class="si">%d</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkt</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Scoreboard</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">add_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created with reorder_depth </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">reorder_depth</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">EndianSwapTB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@cocotb.coroutine</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dut</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Resetting DUT&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will display as something like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">0</span>.00ns INFO                   cocotb.scoreboard.endian_swapper_sv       scoreboard.py:177  in add_interface                   Created with reorder_depth <span class="m">0</span>
<span class="m">0</span>.00ns DEBUG                  cocotb.endian_swapper_sv           .._endian_swapper.py:106  in reset                           Resetting DUT
<span class="m">160000000000000</span>.00ns INFO     cocotb.endian_swapper_sv.stream_out           avalon.py:151  in _monitor_recv                   Received a packet of <span class="m">125</span> bytes
</pre></div>
</div>
</div>
<div class="section" id="busses">
<h2>Busses<a class="headerlink" href="#busses" title="Permalink to this headline">¶</a></h2>
<p>Busses are simply defined as collection of signals. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Bus</span></code> class will automatically bundle any group of signals together that are named similar to dut.&lt;bus_name&gt;&lt;seperator&gt;&lt;signal_name&gt;. for instance,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dut</span><span class="o">.</span><span class="n">stream_in_valid</span>
<span class="n">dut</span><span class="o">.</span><span class="n">stream_in_data</span>
</pre></div>
</div>
<p>have a bus name of <code class="docutils literal notranslate"><span class="pre">stream_in</span></code>, a seperator of <code class="docutils literal notranslate"><span class="pre">_</span></code>, and signal names of <code class="docutils literal notranslate"><span class="pre">valid</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code>. a list of signal names, or a dictionary mapping attribute names to signal names is also passed into the <code class="xref py py-class docutils literal notranslate"><span class="pre">Bus</span></code> class. Busses can have values driven onto them, be captured (returning a dictionary), or sampled and stored into a similar object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stream_in_bus</span> <span class="o">=</span> <span class="n">Bus</span><span class="p">(</span><span class="n">dut</span><span class="p">,</span> <span class="s2">&quot;stream_in&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">])</span> <span class="c1"># &#39;_&#39; is the default seperator</span>
</pre></div>
</div>
</div>
<div class="section" id="driving-busses">
<h2>Driving Busses<a class="headerlink" href="#driving-busses" title="Permalink to this headline">¶</a></h2>
<p>examples and specific bus implementation bus drivers (amba, avalon, xgmii, and others) exist in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Driver</span></code> class enabling a test to append transactions to perform the serialization of transactions onto a physical interface. Here’s an example using the avalon bus driver in the endian swapper example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>&#64;cocotb.coroutine</p>
<p>class EndianSwapperTB(object):</p>
<blockquote>
<div><dl class="docutils">
<dt>def __init__(self, dut, debug=False):</dt>
<dd>self.dut = dut
self.stream_in = AvalonSTDriver(dut, “stream_in”, dut.clk)</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>def run_test(dut, data_in=None, config_coroutine=None, idle_inserter=None,</dt>
<dd><blockquote class="first">
<div>backpressure_inserter=None):</div></blockquote>
<p>cocotb.fork(Clock(dut.clk, 5000).start())
tb = EndianSwapperTB(dut)</p>
<p>yield tb.reset()
dut.stream_out_ready &lt;= 1</p>
<dl class="docutils">
<dt>if idle_inserter is not None:</dt>
<dd>tb.stream_in.set_valid_generator(idle_inserter())</dd>
</dl>
<p># Send in the packets
for transaction in data_in():</p>
<blockquote class="last">
<div>yield tb.stream_in.send(transaction)</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="monitoring-busses">
<h2>Monitoring Busses<a class="headerlink" href="#monitoring-busses" title="Permalink to this headline">¶</a></h2>
<p>For our testbenches to actually be useful, we have to monitor some of these busses, and not just drive them. That’s where the <code class="xref py py-class docutils literal notranslate"><span class="pre">Monitor</span></code> class comes in, with prebuilt Monitors for <strong>avalon</strong> and <strong>xgmii</strong> busses. The Monitor class is a base class which you are expected to derive for your particular purpose. You must create a <cite>_monitor_recv()</cite> function which is responsible for determining 1) at what points in simulation to call the <cite>_recv()</cite> function, and 2) what transaction values to pass to be stored in the monitors receiving queue. Monitors are good for both outputs of the dut for verification, and for the inputs of the dut, to drive a test model of the dut to be compared to the actual dut. For this purpose, input monitors will often have a callback function passed that is a model. This model will often generate expected transactions, which are then compared using the <strong>Scoreboard</strong> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p># ==============================================================================
class BitMonitor(Monitor):</p>
<blockquote>
<div><p>“”“Observes single input or output of DUT.”“”
def __init__(self, name, signal, clock, callback=None, event=None):</p>
<blockquote>
<div>self.name = name
self.signal = signal
self.clock = clock
Monitor.__init__(self, callback, event)</div></blockquote>
<p>&#64;coroutine
def _monitor_recv(self):</p>
<blockquote>
<div><p>clkedge = RisingEdge(self.clock)</p>
<dl class="docutils">
<dt>while True:</dt>
<dd># Capture signal at rising edge of clock
yield clkedge
vec = self.signal.value
self._recv(vec)</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p># ==============================================================================
def input_gen():</p>
<blockquote>
<div><p>“”“Generator for input data applied by BitDriver”“”
while True:</p>
<blockquote>
<div>yield random.randint(1,5), random.randint(1,5)</div></blockquote>
</div></blockquote>
<p># ==============================================================================
class DFF_TB(object):</p>
<blockquote>
<div><p>def __init__(self, dut, init_val):</p>
<blockquote>
<div><p>self.dut = dut</p>
<p># Create input driver and output monitor
self.input_drv = BitDriver(dut.d, dut.c, input_gen())
self.output_mon = BitMonitor(“output”, dut.q, dut.c)</p>
<p># Create a scoreboard on the outputs
self.expected_output = [ init_val ]</p>
<p># Reconstruct the input transactions from the pins
# and send them to our ‘model’
self.input_mon = BitMonitor(“input”, dut.d, dut.c, callback=self.model)</p>
</div></blockquote>
<dl class="docutils">
<dt>def model(self, transaction):</dt>
<dd><p class="first">“”“Model the DUT based on the input transaction.”“”
# Do not append an output transaction for the last clock cycle of the
# simulation, that is, after stop() has been called.
if not self.stopped:</p>
<blockquote class="last">
<div>self.expected_output.append(transaction)</div></blockquote>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="tracking-testbench-errors">
<h2>Tracking testbench errors<a class="headerlink" href="#tracking-testbench-errors" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Scoreboard</span></code> class is used to compare the actual outputs to expected outputs. Monitors are added to the scoreboard for the actual outputs, and the expected outputs can be either a simple list, or a function that provides a transaction. Here’s some code from the <strong>DFF</strong> example, similar to above with the scoreboard added.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl class="docutils">
<dt>class DFF_TB(object):</dt>
<dd><dl class="first last docutils">
<dt>def __init__(self, dut, init_val):</dt>
<dd><p class="first">self.dut = dut</p>
<p># Create input driver and output monitor
self.input_drv = BitDriver(dut.d, dut.c, input_gen())
self.output_mon = BitMonitor(“output”, dut.q, dut.c)</p>
<p># Create a scoreboard on the outputs
self.expected_output = [ init_val ]
self.scoreboard = Scoreboard(dut)
self.scoreboard.add_interface(self.output_mon, self.expected_output)</p>
<p class="last"># Reconstruct the input transactions from the pins
# and send them to our ‘model’
self.input_mon = BitMonitor(“input”, dut.d, dut.c,callback=self.model)</p>
</dd>
</dl>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Test Bench Tools</a><ul>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#busses">Busses</a></li>
<li><a class="reference internal" href="#driving-busses">Driving Busses</a></li>
<li><a class="reference internal" href="#monitoring-busses">Monitoring Busses</a></li>
<li><a class="reference internal" href="#tracking-testbench-errors">Tracking testbench errors</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="triggers.html"
                        title="previous chapter">Triggers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="library_reference.html"
                        title="next chapter">Library Reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/testbench_tools.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="library_reference.html" title="Library Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="triggers.html" title="Triggers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">cocotb 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, PotentialVentures.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.0.
    </div>
  </body>
</html>