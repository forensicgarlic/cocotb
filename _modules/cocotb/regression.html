
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cocotb.regression &#8212; cocotb 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">cocotb 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cocotb.regression</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39; Copyright (c) 2013 Potential Ventures Ltd</span>
<span class="sd">Copyright (c) 2013 SolarFlare Communications Inc</span>
<span class="sd">All rights reserved.</span>

<span class="sd">Redistribution and use in source and binary forms, with or without</span>
<span class="sd">modification, are permitted provided that the following conditions are met:</span>
<span class="sd">    * Redistributions of source code must retain the above copyright</span>
<span class="sd">      notice, this list of conditions and the following disclaimer.</span>
<span class="sd">    * Redistributions in binary form must reproduce the above copyright</span>
<span class="sd">      notice, this list of conditions and the following disclaimer in the</span>
<span class="sd">      documentation and/or other materials provided with the distribution.</span>
<span class="sd">    * Neither the name of Potential Ventures Ltd,</span>
<span class="sd">      SolarFlare Communications Inc nor the</span>
<span class="sd">      names of its contributors may be used to endorse or promote products</span>
<span class="sd">      derived from this software without specific prior written permission.</span>

<span class="sd">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<span class="sd">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="sd">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="sd">DISCLAIMED. IN NO EVENT SHALL POTENTIAL VENTURES LTD BE LIABLE FOR ANY</span>
<span class="sd">DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="sd">(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<span class="sd">LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<span class="sd">ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="sd">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="sd">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. &#39;&#39;&#39;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">All things relating to regression capabilities</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># For autodocumentation don&#39;t need the extension modules</span>
<span class="k">if</span> <span class="s2">&quot;SPHINX_BUILD&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">simulator</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simulator</span>

<span class="c1"># Optional support for coverage collection of testbench files</span>
<span class="n">coverage</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="s2">&quot;COVERAGE&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">coverage</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Coverage collection requested but coverage module not availble&quot;</span>
               <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
               <span class="s2">&quot;Import error was: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">cocotb</span>
<span class="kn">import</span> <span class="nn">cocotb.ANSI</span> <span class="k">as</span> <span class="nn">ANSI</span>
<span class="kn">from</span> <span class="nn">cocotb.log</span> <span class="k">import</span> <span class="n">SimLog</span>
<span class="kn">from</span> <span class="nn">cocotb.result</span> <span class="k">import</span> <span class="n">TestError</span><span class="p">,</span> <span class="n">TestFailure</span><span class="p">,</span> <span class="n">TestSuccess</span><span class="p">,</span> <span class="n">SimFailure</span>
<span class="kn">from</span> <span class="nn">cocotb.utils</span> <span class="k">import</span> <span class="n">get_sim_time</span>
<span class="kn">from</span> <span class="nn">cocotb.xunit_reporter</span> <span class="k">import</span> <span class="n">XUnitReporter</span>


<span class="k">def</span> <span class="nf">_my_import</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mod</span>


<span class="k">class</span> <span class="nc">RegressionManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encapsulates all regression capability into a single place&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_name</span><span class="p">,</span> <span class="n">modules</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hooks</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            modules (list): A list of python module names to run</span>

<span class="sd">        Kwargs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_name</span> <span class="o">=</span> <span class="n">root_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modules</span> <span class="o">=</span> <span class="n">modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span> <span class="o">=</span> <span class="n">tests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">SimLog</span><span class="p">(</span><span class="s2">&quot;cocotb.regression&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="o">=</span> <span class="n">hooks</span>

    <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ntests</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span> <span class="o">=</span> <span class="n">XUnitReporter</span><span class="p">()</span>

        <span class="n">suite_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;RESULT_TESTSUITE&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;RESULT_TESTSUITE&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;all&quot;</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;RESULT_TESTPACKAGE&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;RESULT_TESTPACKAGE&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;all&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_testsuite</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">suite_name</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ntests</span><span class="p">),</span>
                                 <span class="n">package</span><span class="o">=</span><span class="n">package_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;random_seed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">coverage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enabling coverage collection of Python code&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">coverage</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*cocotb*&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="n">handle</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">get_root_handle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_root_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dut</span> <span class="o">=</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">SimHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="k">if</span> <span class="n">handle</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Can not find Root Handle (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">_root_name</span><span class="p">)</span>

        <span class="c1"># Auto discovery</span>
        <span class="k">for</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modules</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">_my_import</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Failed to import module </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MODULE variable was </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modules</span><span class="p">))</span>
                <span class="k">raise</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="p">:</span>

                <span class="c1"># Specific functions specified, don&#39;t auto discover</span>
                <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functions</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Test </span><span class="si">%s</span><span class="s2"> doesn&#39;t exist in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                             <span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">module_name</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">test</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dut</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ntests</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s2">&quot;im_test&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="n">thing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dut</span><span class="p">)</span>
                        <span class="n">skip</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">skip</span>
                    <span class="k">except</span> <span class="n">TestError</span><span class="p">:</span>
                        <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to initialise test </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                         <span class="n">thing</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping test </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">thing</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_testcase</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">thing</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                <span class="n">classname</span><span class="o">=</span><span class="n">module_name</span><span class="p">,</span>
                                                <span class="n">time</span><span class="o">=</span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span>
                                                <span class="n">sim_time_ns</span><span class="o">=</span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span>
                                                <span class="n">ratio_time</span><span class="o">=</span><span class="s2">&quot;0.0&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_skipped</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_store_test_result</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">thing</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ntests</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">funcname</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">valid_tests</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found test </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">valid_tests</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                           <span class="n">valid_tests</span><span class="o">.</span><span class="n">funcname</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading hook from module &#39;&quot;</span><span class="o">+</span><span class="n">module_name</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">_my_import</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s2">&quot;im_hook&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="n">thing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dut</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">TestError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to initialize hook </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">thing</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cocotb</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">tear_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;It&#39;s the end of the world as we know it&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failures</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed </span><span class="si">%d</span><span class="s2"> out of </span><span class="si">%d</span><span class="s2"> tests (</span><span class="si">%d</span><span class="s2"> skipped)&quot;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Passed </span><span class="si">%d</span><span class="s2"> tests (</span><span class="si">%d</span><span class="s2"> skipped)&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing coverage data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov</span><span class="o">.</span><span class="n">html_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_test_summary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_sim_summary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Shutting down...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="n">simulator</span><span class="o">.</span><span class="n">stop_simulator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">next_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the next test to run&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_failure</span><span class="p">(</span><span class="n">stdout</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)),</span>
                               <span class="n">stderr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">error_messages</span><span class="p">),</span>
                               <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Test failed with random_seed=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">handle_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle a test result</span>

<span class="sd">        Dumps result to XML and schedules the next test (if any)</span>

<span class="sd">        Args: result (TestComplete exception)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">real_time</span>   <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">start_time</span>
        <span class="n">sim_time_ns</span> <span class="o">=</span> <span class="n">get_sim_time</span><span class="p">(</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">start_sim_time</span>
        <span class="n">ratio_time</span>  <span class="o">=</span> <span class="n">sim_time_ns</span> <span class="o">/</span> <span class="n">real_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xunit</span><span class="o">.</span><span class="n">add_testcase</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">funcname</span><span class="p">,</span>
                                <span class="n">classname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                                <span class="n">time</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">real_time</span><span class="p">),</span>
                                <span class="n">sim_time_ns</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">sim_time_ns</span><span class="p">),</span>
                                <span class="n">ratio_time</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">ratio_time</span><span class="p">))</span>

        <span class="n">running_test_funcname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">funcname</span>

        <span class="c1"># Helper for logging result</span>
        <span class="k">def</span> <span class="nf">_result_was</span><span class="p">():</span>
            <span class="n">result_was</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (result was </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">running_test_funcname</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result_was</span>

        <span class="n">result_pass</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">TestSuccess</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_fail</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_error</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test Passed: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">running_test_funcname</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">TestFailure</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_fail</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test failed as expected: &quot;</span> <span class="o">+</span> <span class="n">_result_was</span><span class="p">())</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">TestSuccess</span><span class="p">)</span> <span class="ow">and</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_error</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Test passed but we expected an error: &quot;</span> <span class="o">+</span>
                           <span class="n">_result_was</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_failure</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">result_pass</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">TestSuccess</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Test passed but we expected a failure: &quot;</span> <span class="o">+</span>
                           <span class="n">_result_was</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_failure</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">result_pass</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">TestError</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test errored as expected: &quot;</span> <span class="o">+</span> <span class="n">_result_was</span><span class="p">())</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SimFailure</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">expect_error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test errored as expected: &quot;</span> <span class="o">+</span> <span class="n">_result_was</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Test error has lead to simulator shuttting us &quot;</span>
                               <span class="s2">&quot;down&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_failure</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_store_test_result</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">funcname</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sim_time_ns</span><span class="p">,</span> <span class="n">real_time</span><span class="p">,</span> <span class="n">ratio_time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Test Failed: &quot;</span> <span class="o">+</span> <span class="n">_result_was</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_failure</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">result_pass</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_store_test_result</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">funcname</span><span class="p">,</span> <span class="n">result_pass</span><span class="p">,</span> <span class="n">sim_time_ns</span><span class="p">,</span> <span class="n">real_time</span><span class="p">,</span> <span class="n">ratio_time</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span> <span class="o">=</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">next_test</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">end</span>   <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">colour</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ANSI</span><span class="o">.</span><span class="n">BLUE_BG</span> <span class="o">+</span> <span class="n">ANSI</span><span class="o">.</span><span class="n">BLACK_FG</span>
                <span class="n">end</span>   <span class="o">=</span> <span class="n">ANSI</span><span class="o">.</span><span class="n">DEFAULT</span>
            <span class="c1"># Want this to stand out a little bit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Running test </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">:</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                          <span class="p">(</span><span class="n">start</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ntests</span><span class="p">,</span>
                           <span class="n">end</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="o">.</span><span class="n">funcname</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">new_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_running_test</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_log_test_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">TEST_FIELD</span>   <span class="o">=</span> <span class="s1">&#39;TEST&#39;</span>
        <span class="n">RESULT_FIELD</span> <span class="o">=</span> <span class="s1">&#39;PASS/FAIL&#39;</span>
        <span class="n">SIM_FIELD</span>    <span class="o">=</span> <span class="s1">&#39;SIM TIME(NS)&#39;</span>
        <span class="n">REAL_FIELD</span>   <span class="o">=</span> <span class="s1">&#39;REAL TIME(S)&#39;</span>
        <span class="n">RATIO_FIELD</span>  <span class="o">=</span> <span class="s1">&#39;RATIO(NS/S)&#39;</span>

        <span class="n">TEST_FIELD_LEN</span>   <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TEST_FIELD</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)))</span>
        <span class="n">RESULT_FIELD_LEN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RESULT_FIELD</span><span class="p">)</span>
        <span class="n">SIM_FIELD_LEN</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">SIM_FIELD</span><span class="p">)</span>
        <span class="n">REAL_FIELD_LEN</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">REAL_FIELD</span><span class="p">)</span>
        <span class="n">RATIO_FIELD_LEN</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RATIO_FIELD</span><span class="p">)</span>

        <span class="n">LINE_LEN</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">TEST_FIELD_LEN</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">RESULT_FIELD_LEN</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">SIM_FIELD_LEN</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">REAL_FIELD_LEN</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">RATIO_FIELD_LEN</span> <span class="o">+</span> <span class="mi">3</span>

        <span class="n">LINE_SEP</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="n">LINE_LEN</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="n">LINE_SEP</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;** {a:&lt;</span><span class="si">{a_len}</span><span class="s2">}  {b:^</span><span class="si">{b_len}</span><span class="s2">}  {c:&gt;</span><span class="si">{c_len}</span><span class="s2">}  {d:&gt;</span><span class="si">{d_len}</span><span class="s2">}  {e:&gt;</span><span class="si">{e_len}</span><span class="s2">} **</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">TEST_FIELD</span><span class="p">,</span>   <span class="n">a_len</span><span class="o">=</span><span class="n">TEST_FIELD_LEN</span><span class="p">,</span>
                                                                                                         <span class="n">b</span><span class="o">=</span><span class="n">RESULT_FIELD</span><span class="p">,</span> <span class="n">b_len</span><span class="o">=</span><span class="n">RESULT_FIELD_LEN</span><span class="p">,</span>
                                                                                                         <span class="n">c</span><span class="o">=</span><span class="n">SIM_FIELD</span><span class="p">,</span>    <span class="n">c_len</span><span class="o">=</span><span class="n">SIM_FIELD_LEN</span><span class="p">,</span>
                                                                                                         <span class="n">d</span><span class="o">=</span><span class="n">REAL_FIELD</span><span class="p">,</span>   <span class="n">d_len</span><span class="o">=</span><span class="n">REAL_FIELD_LEN</span><span class="p">,</span>
                                                                                                         <span class="n">e</span><span class="o">=</span><span class="n">RATIO_FIELD</span><span class="p">,</span>  <span class="n">e_len</span><span class="o">=</span><span class="n">RATIO_FIELD_LEN</span><span class="p">)</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="n">LINE_SEP</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="p">:</span>
            <span class="n">hilite</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pass_fail_str</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
            <span class="k">elif</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]:</span>
                <span class="n">pass_fail_str</span> <span class="o">=</span> <span class="s2">&quot;PASS&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pass_fail_str</span> <span class="o">=</span> <span class="s2">&quot;FAIL&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">colour</span><span class="p">:</span>
                    <span class="n">hilite</span> <span class="o">=</span> <span class="n">ANSI</span><span class="o">.</span><span class="n">WHITE_FG</span> <span class="o">+</span> <span class="n">ANSI</span><span class="o">.</span><span class="n">RED_BG</span>

            <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{start}</span><span class="s2">** {a:&lt;</span><span class="si">{a_len}</span><span class="s2">}  {b:^</span><span class="si">{b_len}</span><span class="s2">}  {c:&gt;</span><span class="si">{c_len}</span><span class="s2">.2f}   {d:&gt;</span><span class="si">{d_len}</span><span class="s2">.2f}   {e:&gt;</span><span class="si">{e_len}</span><span class="s2">.2f}  **</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span>   <span class="n">a_len</span><span class="o">=</span><span class="n">TEST_FIELD_LEN</span><span class="p">,</span>
                                                                                                                                <span class="n">b</span><span class="o">=</span><span class="n">pass_fail_str</span><span class="p">,</span>    <span class="n">b_len</span><span class="o">=</span><span class="n">RESULT_FIELD_LEN</span><span class="p">,</span>
                                                                                                                                <span class="n">c</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">],</span>    <span class="n">c_len</span><span class="o">=</span><span class="n">SIM_FIELD_LEN</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                                                <span class="n">d</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;real&#39;</span><span class="p">],</span>   <span class="n">d_len</span><span class="o">=</span><span class="n">REAL_FIELD_LEN</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                                                <span class="n">e</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">],</span>  <span class="n">e_len</span><span class="o">=</span><span class="n">RATIO_FIELD_LEN</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                                                <span class="n">start</span><span class="o">=</span><span class="n">hilite</span><span class="p">)</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="n">LINE_SEP</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_sim_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">real_time</span>   <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="n">sim_time_ns</span> <span class="o">=</span> <span class="n">get_sim_time</span><span class="p">(</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span>
        <span class="n">ratio_time</span>  <span class="o">=</span> <span class="n">sim_time_ns</span> <span class="o">/</span> <span class="n">real_time</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;*************************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;**                                 ERRORS : </span><span class="si">{0:&lt;39}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failures</span><span class="p">)</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;*************************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;**                               SIM TIME : </span><span class="si">{0:&lt;39}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> NS&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sim_time_ns</span><span class="p">))</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;**                              REAL TIME : </span><span class="si">{0:&lt;39}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> S&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">real_time</span><span class="p">))</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;**                        SIM / REAL TIME : </span><span class="si">{0:&lt;39}</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> NS/S&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ratio_time</span><span class="p">))</span>
        <span class="n">summary</span> <span class="o">+=</span> <span class="s2">&quot;*************************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_store_test_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">result_pass</span><span class="p">,</span> <span class="n">sim_time</span><span class="p">,</span> <span class="n">real_time</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;test&#39;</span>  <span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">module_name</span><span class="p">,</span> <span class="n">test_name</span><span class="p">]),</span>
            <span class="s1">&#39;pass&#39;</span>  <span class="p">:</span> <span class="n">result_pass</span><span class="p">,</span>
            <span class="s1">&#39;sim&#39;</span>   <span class="p">:</span> <span class="n">sim_time</span><span class="p">,</span>
            <span class="s1">&#39;real&#39;</span>  <span class="p">:</span> <span class="n">real_time</span><span class="p">,</span>
            <span class="s1">&#39;ratio&#39;</span> <span class="p">:</span> <span class="n">ratio</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_create_test</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">documentation</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory function to create tests, avoids late binding</span>

<span class="sd">    Creates a test dynamically.  The test will call the supplied</span>
<span class="sd">    function with the supplied arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        function: (function)    the test function to run</span>

<span class="sd">        name: (string)          the name of the test</span>

<span class="sd">        documentation: (string) the docstring for the test</span>

<span class="sd">        mod: (module)           the module this function belongs to</span>

<span class="sd">        *args:                  remaining args to pass to test function</span>

<span class="sd">    Kwaygs:</span>
<span class="sd">        **kwargs:               passed to the test function</span>

<span class="sd">    Returns:</span>
<span class="sd">        decorated test function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_my_test</span><span class="p">(</span><span class="n">dut</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">function</span><span class="p">(</span><span class="n">dut</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">_my_test</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">_my_test</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">documentation</span>
    <span class="n">_my_test</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">test</span><span class="p">()(</span><span class="n">_my_test</span><span class="p">)</span>


<div class="viewcode-block" id="TestFactory"><a class="viewcode-back" href="../../library_reference.html#cocotb.regression.TestFactory">[docs]</a><span class="k">class</span> <span class="nc">TestFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to automatically generate tests.</span>

<span class="sd">    Assuming we have a common test function that will run a test. This test</span>
<span class="sd">    function will take keyword arguments (for example generators for each of</span>
<span class="sd">    the input interfaces) and generate tests that call the supplied function.</span>

<span class="sd">    This Factory allows us to generate sets of tests based on the different</span>
<span class="sd">    permutations of the possible arguments to the test function.</span>

<span class="sd">    For example if we have a module that takes backpressure and idles and</span>
<span class="sd">    have some packet generations routines gen_a and gen_b.</span>

<span class="sd">    &gt;&gt;&gt; tf = TestFactory(run_test)</span>
<span class="sd">    &gt;&gt;&gt; tf.add_option(&#39;data_in&#39;, [gen_a, gen_b])</span>
<span class="sd">    &gt;&gt;&gt; tf.add_option(&#39;backpressure&#39;, [None, random_backpressure])</span>
<span class="sd">    &gt;&gt;&gt; tf.add_option(&#39;idles&#39;, [None, random_idles])</span>
<span class="sd">    &gt;&gt;&gt; tf.generate_tests()</span>

<span class="sd">    We would get the following tests:</span>
<span class="sd">        * gen_a with no backpressure and no idles</span>
<span class="sd">        * gen_a with no backpressure and random_idles</span>
<span class="sd">        * gen_a with random_backpressure and no idles</span>
<span class="sd">        * gen_a with random_backpressure and random_idles</span>
<span class="sd">        * gen_b with no backpressure and no idles</span>
<span class="sd">        * gen_b with no backpressure and random_idles</span>
<span class="sd">        * gen_b with random_backpressure and no idles</span>
<span class="sd">        * gen_b with random_backpressure and random_idles</span>

<span class="sd">    The tests are appended to the calling module for auto-discovery.</span>

<span class="sd">    Tests are simply named test_function_N. The docstring for the test (hence</span>
<span class="sd">    the test description) includes the name and description of each generator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_function</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            test_function (function): the function that executes a test.</span>
<span class="sd">                                      Must take &#39;dut&#39; as the first argument.</span>

<span class="sd">            *args: Remaining args are passed directly to the test function.</span>
<span class="sd">                   Note that these arguments are not varied. An argument that</span>
<span class="sd">                   varies with each test must be a keyword argument to the</span>
<span class="sd">                   test function.</span>
<span class="sd">            *kwargs: Remaining kwargs are passed directly to the test function.</span>
<span class="sd">                   Note that these arguments are not varied. An argument that</span>
<span class="sd">                   varies with each test must be a keyword argument to the</span>
<span class="sd">                   test function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_function</span><span class="p">,</span> <span class="n">cocotb</span><span class="o">.</span><span class="n">coroutine</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TestFactory requires a cocotb coroutine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_function</span> <span class="o">=</span> <span class="n">test_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_function</span><span class="o">.</span><span class="n">_func</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_constant</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="TestFactory.add_option"><a class="viewcode-back" href="../../library_reference.html#cocotb.regression.TestFactory.add_option">[docs]</a>    <span class="k">def</span> <span class="nf">add_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">optionlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a named option to the test.</span>

<span class="sd">        Args:</span>
<span class="sd">           name (string): name of the option. passed to test as a keyword</span>
<span class="sd">                          argument</span>

<span class="sd">           optionlist (list): A list of possible options for this test knob</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">optionlist</span>

<div class="viewcode-block" id="TestFactory.generate_tests"><a class="viewcode-back" href="../../library_reference.html#cocotb.regression.TestFactory.generate_tests">[docs]</a>    <span class="k">def</span> <span class="nf">generate_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates exhasutive set of tests using the cartesian product of the</span>
<span class="sd">        possible keyword arguments.</span>

<span class="sd">        The generated tests are appended to the namespace of the calling</span>
<span class="sd">        module.</span>

<span class="sd">        Args:</span>
<span class="sd">            prefix:  Text string to append to start of test_function name</span>
<span class="sd">                     when naming generated test cases. This allows reuse of</span>
<span class="sd">                     a single test_function with multiple TestFactories without</span>
<span class="sd">                     name clashes.</span>
<span class="sd">            postfix: Text string to append to end of test_function name</span>
<span class="sd">                     when naming generated test cases. This allows reuse of</span>
<span class="sd">                     a single test_function with multiple TestFactories without</span>
<span class="sd">                     name clashes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">frm</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmodule</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">testoptions</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span>
                                            <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                            <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                                            <span class="p">)):</span>

            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">_</span><span class="si">%03d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">postfix</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;Automatically generated test</span><span class="se">\n\n</span><span class="s2">&quot;</span>

            <span class="k">for</span> <span class="n">optname</span><span class="p">,</span> <span class="n">optvalue</span> <span class="ow">in</span> <span class="n">testoptions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">optvalue</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">optvalue</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                        <span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;No docstring supplied&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">desc</span> <span class="o">=</span> <span class="n">optvalue</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">doc</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optname</span><span class="p">,</span> <span class="n">optvalue</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                <span class="n">desc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optname</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">optvalue</span><span class="p">))</span>

            <span class="n">cocotb</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding generated test </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> to module </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_constant</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">testoptions</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">cocotb</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Overwriting </span><span class="si">%s</span><span class="s2"> in module </span><span class="si">%s</span><span class="s2">. &quot;</span>
                                 <span class="s2">&quot;This causes previously defined testcase &quot;</span>
                                 <span class="s2">&quot;not to be run. Consider setting/changing &quot;</span>
                                 <span class="s2">&quot;name_postfix&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mod</span><span class="p">))</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_create_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_function</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span></div></div>
                                            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">cocotb 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, PotentialVentures.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.0.
    </div>
  </body>
</html>